---
import { SEO } from "astro-seo";
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";
interface Props {
  post: CollectionEntry<"posts">;
}

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  return posts.map((post: CollectionEntry<"posts">) => ({
    params: { slug: post.slug },
    props: {
      post,
    },
  }));
}

const { post } = Astro.props;
const { Content, headings } = await post.render();

// スライドかどうかを判定
const isSlide = post.data.marp;

import "destyle.css";
import "../../styles/global.css";
import { Header } from "../../features/Header";
import { Footer } from "../../features/Footer";
import BlogPost from "./_components/BlogPost/index.astro";
import SlidePost from "./_components/SlidePost.astro";
import { Breadcrumb } from "../../ui/Breadcrumb";
import { SITE_URL } from "../../consts";
---

<!doctype html>
<html lang="ja">
  <head>
    <link rel="icon" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <SEO
      charset="UTF-8"
      title={`${post.data.title} | yutteee-portfolio`}
      description={post.data.description}
      openGraph={{
        basic: {
          title: post.data.title,
          type: "article",
          image: `${SITE_URL}/ogp/${post.slug}.png`,
        },
        image: {
          alt: post.data.title,
        },
      }}
      extend={{
        meta: [
          {
            name: "twitter:card",
            content: "summary_large_image",
          },
          { name: "twitter:site", content: "@yutteee-portfolio" },
          { name: "twitter:creator", content: "@yutteee" },
        ],
      }}
    />
  </head>
  <body>
    <Header currentPage="記事" client:load />
    <main class="container">
      <Breadcrumb
        items={[
          { label: "トップ", href: "/" },
          { label: "記事", href: "/posts" },
        ]}
        currentLabel={post.data.title}
      />

      {
        isSlide ? (
          <SlidePost post={post} />
        ) : (
          <BlogPost post={post} Content={Content} headings={headings} />
        )
      }
    </main>
    <Footer client:only />

    <style>
      .container {
        width: 100%;
        max-width: calc(70rem + 2rem);
        margin: 0 auto;
        padding: 96px 16px;
      }
    </style>
  </body>
</html>
